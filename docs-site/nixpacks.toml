providers = ["bun"]

[variables]
NODE_ENV = "production"

[phases.setup]
# Install nginx
nixPkgs = ["nginx"]

[phases.install]
# Install dependencies using Bun
cmds = ["bun install --frozen-lockfile"]

[phases.build]
# Build the application using Bun and setup nginx
cmds = [
  "bun run build",
  "mkdir -p /usr/share/nginx/html",
  "cp -r dist/* /usr/share/nginx/html/",
  "cp nginx.conf /etc/nginx/nginx.conf"
]

[start]
# Start command for production - use nginx to serve static files
cmd = "nginx -g 'daemon off;'"

[staticAssets]
# Serve static files from dist directory
dir = "dist"

[cache]
# Cache node_modules and Astro build cache
paths = [
  "node_modules",
  ".astro"
]
